<script type="text/javascript">
    //<![CDATA[
    function doSetup() {
        button = $('loyaltylion_setup_button');
	token = $('loyaltylion_configuration_loyaltylion_token').value
	secret = $('loyaltylion_configuration_loyaltylion_secret').value
        new Ajax.Request('<?php echo $this->getAjaxSetupUrl() ?>', {
            method: 'get',
            parameters: { 'token':token, 'secret': secret },
            onSuccess: function(transport){
                switch (transport.responseText) {
                case "ok":
                    button.removeClassName('fail').addClassName('success');
                    button.update("Success");
                    break;
                case "not-configured-yet":
                    button.removeClassName('fail').removeClassName('success');
                    button.update("Please enter your Token / Secret first");
                    break;
		default:
                    button.removeClassName('success').addClassName('fail');
		    button.update("Error - are you sure you entered the right Token / Secret?");
                }
            },
            onError: function(transport){
                button.removeClassName('success').addClassName('fail');
                button.update("Error");
            }
        });
    }
    //]]>
</script>
 
<?php echo $this->getButtonHtml() ?>
